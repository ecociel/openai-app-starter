<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Table Booking</title>
    <style>
        :root { color-scheme: dark light; }
        body { color: #e8e8e8; background: transparent; font-family: sans-serif; }

        h1 { margin: 0 0 12px; font-size: 18px; color: #e8e8e8; }

        /* Ensure labels are readable on dark backgrounds */
        label { color: #e8e8e8; display: grid; gap: 6px; font-size: 13px; }

        /* Improve input and button contrast for dark theme */
        input, button {
            color: #e8e8e8;
            background: #1f1f1f;
            border: 1px solid #444;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        input::placeholder { color: #a8a8a8; }

        button {
            background: #2d6cdf;
            border-color: #2d6cdf;
            cursor: pointer;
        }
        button:hover { background: #215bb3; }

        form { margin: 16px 0; display: grid; gap: 10px; max-width: 420px; }

        #confirmation {
            display: none;
            margin: 10px 0;
            padding: 10px 12px;
            border-radius: 6px;
            background: #eef9f0;
            color: #0a5b26;
            font-size: 13px;
        }

        #prefillNote {
            display: none;
            margin: 8px 0 0;
            color: #b8d4ff;
            font-size: 12px;
        }
    </style>
</head>
<body>
<h1>Table Booking</h1>

<form id="bookingForm">
    <label>
        Restaurant Name
        <input type="text" id="restaurantName" name="restaurantName" placeholder="e.g., Ocean View Diner" required />
    </label>
    <label>
        No. of Persons
        <input type="number" id="numPersons" name="numPersons" min="1" step="1" placeholder="e.g., 4" required />
    </label>
    <label>
        Date
        <input type="date" id="bookingDate" name="bookingDate" required />
    </label>
    <label>
        Time
        <input type="time" id="bookingTime" name="bookingTime" required />
    </label>
    <button type="submit">Book Table</button>
    <div id="prefillNote">Fields were prefilled from tool inputs.</div>
</form>

<div id="confirmation" role="status" aria-live="polite"></div>

<script>
    // Prefill the form from structuredContent (tool output) if provided
    function prefillFromToolOutput() {
        const output = (window.openai && window.openai.toolOutput) || {};
        const prefilled = [];

        const setIf = (id, value) => {
            if (value !== undefined && value !== null && String(value).length > 0) {
                const el = document.getElementById(id);
                if (el) {
                    el.value = String(value);
                    prefilled.push(id);
                }
            }
        };

        setIf("restaurantName", output.restaurantName);
        setIf("numPersons", output.numPersons);
        setIf("bookingDate", output.date);
        setIf("bookingTime", output.time);

        if (prefilled.length > 0) {
            const note = document.getElementById("prefillNote");
            if (note) note.style.display = "block";
            return true;
        }
        return false;
    }

    // Inline confirmation (sandbox disallows alert)
    (function setupForm() {
        const form = document.getElementById("bookingForm");
        const confirmation = document.getElementById("confirmation");
        if (!form || !confirmation) return;

        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const restaurantName = document.getElementById("restaurantName").value.trim();
            const numPersons = document.getElementById("numPersons").value;
            const bookingDate = document.getElementById("bookingDate").value;
            const bookingTime = document.getElementById("bookingTime").value;

            confirmation.textContent =
                `Booking submitted â€” Restaurant: ${restaurantName}; Persons: ${numPersons}; Date: ${bookingDate}; Time: ${bookingTime}`;
            confirmation.style.display = "block";
        });
    })();

    // Try to prefill immediately; if toolOutput isn't ready yet, retry briefly
    if (!prefillFromToolOutput()) {
        const timer = setInterval(() => prefillFromToolOutput() && clearInterval(timer), 200);
        document.addEventListener("visibilitychange", () => !document.hidden && prefillFromToolOutput());
    }
</script>
</body>
</html>